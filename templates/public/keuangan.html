{% extends "base/public.html" %}
{% load i18n humanize hijri_tags %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1 class="page-header-title">{% trans "Laporan Keuangan" %}</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'core:home' %}">{% trans "Beranda" %}</a></li>
                <li class="breadcrumb-item active">{% trans "Keuangan" %}</li>
            </ol>
        </nav>
    </div>
</div>

<div class="container py-5">
    <!-- Filter Bulan -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
            <form method="get" class="row g-3 align-items-end">
                <div class="col-auto">
                    <label class="form-label fw-semibold">{% trans "Bulan" %}</label>
                    <select name="bulan" class="form-select">
                        <option value="1" {% if bulan == 1 %}selected{% endif %}>{% trans "Januari" %}</option>
                        <option value="2" {% if bulan == 2 %}selected{% endif %}>{% trans "Februari" %}</option>
                        <option value="3" {% if bulan == 3 %}selected{% endif %}>{% trans "Maret" %}</option>
                        <option value="4" {% if bulan == 4 %}selected{% endif %}>{% trans "April" %}</option>
                        <option value="5" {% if bulan == 5 %}selected{% endif %}>{% trans "Mei" %}</option>
                        <option value="6" {% if bulan == 6 %}selected{% endif %}>{% trans "Juni" %}</option>
                        <option value="7" {% if bulan == 7 %}selected{% endif %}>{% trans "Juli" %}</option>
                        <option value="8" {% if bulan == 8 %}selected{% endif %}>{% trans "Agustus" %}</option>
                        <option value="9" {% if bulan == 9 %}selected{% endif %}>{% trans "September" %}</option>
                        <option value="10" {% if bulan == 10 %}selected{% endif %}>{% trans "Oktober" %}</option>
                        <option value="11" {% if bulan == 11 %}selected{% endif %}>{% trans "November" %}</option>
                        <option value="12" {% if bulan == 12 %}selected{% endif %}>{% trans "Desember" %}</option>
                    </select>
                </div>
                <div class="col-auto">
                    <label class="form-label fw-semibold">{% trans "Tahun" %}</label>
                    <input type="number" name="tahun" class="form-control" value="{{ tahun }}" min="2020" max="2030">
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-search me-1"></i>{% trans "Tampilkan" %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body d-flex align-items-center gap-3 p-4">
                    <div class="icon-box bg-success-subtle text-success rounded-3 p-3">
                        <i class="bi bi-arrow-down-circle fs-4"></i>
                    </div>
                    <div>
                        <div class="text-muted small">{% trans "Total Pemasukan" %}</div>
                        <div class="fs-5 fw-bold text-success">Rp {{ total_masuk|floatformat:0 }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body d-flex align-items-center gap-3 p-4">
                    <div class="icon-box bg-danger-subtle text-danger rounded-3 p-3">
                        <i class="bi bi-arrow-up-circle fs-4"></i>
                    </div>
                    <div>
                        <div class="text-muted small">{% trans "Total Pengeluaran" %}</div>
                        <div class="fs-5 fw-bold text-danger">Rp {{ total_keluar|floatformat:0 }}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body d-flex align-items-center gap-3 p-4">
                    <div class="icon-box bg-primary-subtle text-primary rounded-3 p-3">
                        <i class="bi bi-wallet2 fs-4"></i>
                    </div>
                    <div>
                        <div class="text-muted small">{% trans "Saldo" %}</div>
                        <div class="fs-5 fw-bold {% if saldo >= 0 %}text-primary{% else %}text-danger{% endif %}">
                            Rp {{ saldo|floatformat:0 }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabel Transaksi -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white py-3 border-bottom fw-bold">
            {% trans "Detail Transaksi" %}
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th>{% trans "Tanggal" %}</th>
                        <th>{% trans "Keterangan" %}</th>
                        <th>{% trans "Kategori" %}</th>
                        <th class="text-end">{% trans "Pemasukan" %}</th>
                        <th class="text-end">{% trans "Pengeluaran" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for t in transaksi_list %}
                    <tr>
                        <td class="text-nowrap">
                            {{ t.tanggal|date:"d M Y" }}
                            <div class="text-muted" style="font-size:0.75rem;">{{ t.tanggal|hijri_short }}</div>
                        </td>
                        <td>{{ t.keterangan }}</td>
                        <td><span class="badge bg-secondary-subtle text-secondary">{{ t.kategori.nama }}</span></td>
                        <td class="text-end text-success fw-semibold">
                            {% if t.kategori.jenis == 'pemasukan' %}Rp {{ t.jumlah|floatformat:0 }}{% endif %}
                        </td>
                        <td class="text-end text-danger fw-semibold">
                            {% if t.kategori.jenis == 'pengeluaran' %}Rp {{ t.jumlah|floatformat:0 }}{% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="5" class="text-center text-muted py-4">{% trans "Belum ada transaksi pada periode ini." %}</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
